---
import { getSortedPosts } from "@utils/content-utils";
import BaseLayout from "../../../components/layout/BaseLayout/BaseLayout.astro";
import PostsTimeline from "../../../components/archive/PostsTimeline.astro";
import { type GetStaticPaths } from "astro";

export const getStaticPaths = (async () => {
	let posts = await getSortedPosts();

	const allTags = posts.reduce((acc, post) => {
		post.data.tags.forEach((tag) => acc.add(tag));
		return acc;
	}, new Set());

	const allTagsArray = Array.from(allTags);

	return allTagsArray.map((tag) => {
		return {
			params: {
				tag: tag
			}
		};
	});
}) satisfies GetStaticPaths;

const { tag } = Astro.params;
---

<BaseLayout title={"Archive"}>
	<PostsTimeline tags={[tag]} />
</BaseLayout>
